<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Paradise Streaming</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c1d, #1a1a3d);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 50px;
            background: rgba(10, 10, 35, 0.95);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 2px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
        }
        
        .logo span {
            color: #ff6b6b;
            -webkit-text-fill-color: #ff6b6b;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        nav a {
            color: #ddd;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 8px 15px;
            border-radius: 4px;
        }
        
        nav a:hover, nav a.active {
            color: #fff;
            background: rgba(255, 107, 107, 0.2);
        }
        
        .search-container {
            position: relative;
            width: 300px;
        }
        
        #movie-search {
            width: 100%;
            padding: 12px 20px;
            border-radius: 30px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            padding-right: 45px;
        }
        
        #movie-search:focus {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }
        
        #movie-search::placeholder {
            color: #aaa;
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(30, 30, 60, 0.95);
            border-radius: 10px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: none;
            z-index: 1000;
        }
        
        .search-results.visible {
            display: block;
        }
        
        .result-item {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s ease;
        }
        
        .result-item:hover {
            background: rgba(255, 107, 107, 0.1);
        }
        
        .result-item img {
            width: 50px;
            height: 70px;
            border-radius: 5px;
            object-fit: cover;
        }
        
        .result-info {
            flex: 1;
        }
        
        .result-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .result-year {
            color: #aaa;
            font-size: 14px;
        }
        
        .hero {
            height: 70vh;
            display: flex;
            align-items: center;
            padding: 0 50px;
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.8)), url('https://source.unsplash.com/random/1920x1080/?anime') no-repeat center center/cover;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .hero-content {
            max-width: 600px;
            z-index: 2;
            position: relative;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            animation: fadeInOut 12s infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; transform: translateY(20px); }
            10%, 30% { opacity: 1; transform: translateY(0); }
            40%, 90% { opacity: 0; transform: translateY(-20px); }
        }
        
        .hero h1:nth-child(1) { animation-delay: 0s; }
        .hero h1:nth-child(2) { animation-delay: 3s; }
        .hero h1:nth-child(3) { animation-delay: 6s; }
        .hero h1:nth-child(4) { animation-delay: 9s; }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            position: relative;
            z-index: 2;
            margin-top: 250px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .section-title {
            font-size: 28px;
            margin-bottom: 25px;
            padding-left: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-right: 50px;
        }
        
        .see-all {
            color: #4ecdc4;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
        }
        
        .see-all:hover {
            text-decoration: underline;
        }
        
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
            padding: 0 50px 50px;
        }
        
        .movie-card {
            background: rgba(30, 30, 60, 0.7);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        .movie-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .movie-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .movie-card:hover img {
            transform: scale(1.05);
        }
        
        .movie-info {
            padding: 15px;
        }
        
        .movie-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .movie-year {
            color: #aaa;
            font-size: 14px;
        }
        
        .movie-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #ffd700;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .type-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(78, 205, 196, 0.8);
            color: #0c0c1d;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .anime-badge {
            background: rgba(78, 205, 196, 0.8);
        }
        
        footer {
            background: rgba(10, 10, 35, 0.95);
            padding: 30px 50px;
            text-align: center;
            margin-top: 40px;
        }
        
        .footer-logo {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #4ecdc4;
        }
        
        .copyright {
            color: #777;
            font-size: 14px;
            margin-top: 15px;
        }
        
        .tmdb-attribution {
            background: rgba(30, 30, 60, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin-top: 30px;
            font-size: 14px;
            text-align: center;
        }
        
        .jikan-attribution {
            background: rgba(30, 30, 60, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        
        .consumet-attribution {
            background: rgba(30, 30, 60, 0.7);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            text-align: center;
        }
        
        .results-page {
            padding: 100px 50px;
            text-align: center;
            display: none;
        }
        
        .results-page h2 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: #4ecdc4;
        }
        
        .results-page p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ecdc4;
        }
        
        .back-btn:hover {
            background: rgba(78, 205, 196, 0.2);
        }
        
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #aaa;
        }
        
        .loader {
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid #4ecdc4;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .genre-filter {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 0 50px;
        }
        
        .genre-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ecdc4;
            color: #4ecdc4;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .genre-btn:hover, .genre-btn.active {
            background: rgba(78, 205, 196, 0.2);
            color: white;
        }
        
        .player-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            overflow: auto;
            padding: 20px;
        }
        
        .player-content {
            max-width: 1000px;
            margin: 50px auto;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: rgba(20, 20, 40, 0.95);
        }
        
        .player-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: white;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .player-header {
            padding: 20px;
            background: rgba(10, 10, 30, 0.9);
        }
        
        .player-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .episode-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .episode-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ecdc4;
            color: #4ecdc4;
            padding: 6px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .episode-btn:hover, .episode-btn.active {
            background: rgba(78, 205, 196, 0.2);
            color: white;
        }
        
        .player-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background: #000;
        }
        
        #anime-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .player-controls {
            padding: 15px 20px;
            background: rgba(10, 10, 30, 0.9);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .player-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #4ecdc4;
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .player-btn:hover {
            background: rgba(78, 205, 196, 0.3);
        }
        
        .player-btn.play {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        }
        
        @media (max-width: 900px) {
            header {
                flex-direction: column;
                gap: 20px;
                padding: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .search-container {
                width: 100%;
                max-width: 400px;
            }
            
            .hero {
                padding: 0 20px;
                text-align: center;
                height: 60vh;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero-content {
                margin: 0 auto;
            }
            
            .section-title, .movies-grid {
                padding-left: 20px;
                padding-right: 20px;
            }
            
            .genre-filter {
                padding: 0 20px;
            }
            
            .btn {
                margin-top: 200px;
            }
            
            .player-content {
                margin: 20px auto;
            }
        }
        
        @media (max-width: 600px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .btn {
                margin-top: 150px;
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .section-title {
                font-size: 22px;
                padding-left: 20px;
                padding-right: 20px;
            }
            
            .genre-btn {
                padding: 6px 15px;
                font-size: 14px;
            }
            
            .player-title {
                font-size: 1.4rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .player-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .player-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div id="main-content">
        <header>
            <div class="logo">LUXURY <span>PARADISE</span></div>
            <nav>
                <ul>
                    <li><a href="#" class="active">Home</a></li>
                    <li><a href="#">Film</a></li>
                    <li><a href="#">Anime</a></li>
                    <li><a href="#">Nuovi</a></li>
                    <li><a href="#">Generi</a></li>
                </ul>
            </nav>
            <div class="search-container">
                <input type="text" id="movie-search" placeholder="Cerca film o anime...">
                <i class="fas fa-search search-icon"></i>
                <div class="search-results" id="search-results"></div>
            </div>
        </header>
        
        <section class="hero">
            <div class="hero-content">
                <h1>Film esclusivi in altissima qualità</h1>
                <h1>I migliori anime sempre disponibili</h1>
                <h1>Nuove uscite ogni settimana</h1>
                <h1>Streaming senza interruzioni</h1>
                <a href="#" class="btn">Inizia a guardare</a>
            </div>
        </section>
        
        <div class="genre-filter">
            <button class="genre-btn active" data-genre="all">Tutti</button>
            <button class="genre-btn" data-genre="28">Azione</button>
            <button class="genre-btn" data-genre="12">Avventura</button>
            <button class="genre-btn" data-genre="16">Animazione</button>
            <button class="genre-btn" data-genre="anime">Anime</button>
            <button class="genre-btn" data-genre="878">Fantascienza</button>
            <button class="genre-btn" data-genre="27">Horror</button>
        </div>
        
        <div class="section-title" id="trending-title">
            <h2>Film in tendenza</h2>
            <a href="#" class="see-all">Vedi tutti &gt;</a>
        </div>
        
        <div class="movies-grid" id="trending-movies">
            <div class="loader"></div>
        </div>
        
        <div class="section-title" id="new-releases-title">
            <h2>Ultime uscite</h2>
            <a href="#" class="see-all">Vedi tutti &gt;</a>
        </div>
        
        <div class="movies-grid" id="new-releases">
            <div class="loader"></div>
        </div>
        
        <div class="section-title" id="anime-title">
            <h2>Anime Popolari</h2>
            <a href="#" class="see-all">Vedi tutti &gt;</a>
        </div>
        
        <div class="movies-grid" id="anime-content">
            <div class="loader"></div>
        </div>
        
        <div class="tmdb-attribution">
            <p>Dati dei film forniti da TMDb</p>
            <p>Questo prodotto utilizza l'API TMDb ma non è approvato o certificato da TMDb.</p>
        </div>
        
        <div class="jikan-attribution">
            <p>Dati anime forniti da Jikan API (MyAnimeList non ufficiale)</p>
        </div>
        
        <div class="consumet-attribution">
            <p>Streaming anime fornito da Consumet API</p>
        </div>
        
        <footer>
            <div class="footer-logo">LUXURY PARADISE</div>
            <div class="footer-links">
                <a href="#">Home</a>
                <a href="#">Film</a>
                <a href="#">Anime</a>
                <a href="#">Nuovi</a>
                <a href="#">Preferiti</a>
                <a href="#">Supporto</a>
                <a href="#">Termini</a>
                <a href="#">Privacy</a>
            </div>
            <div class="copyright">
                © 2023 Luxury Paradise Streaming. Tutti i diritti riservati.
            </div>
        </footer>
    </div>
    
    <div id="player-modal" class="player-modal">
        <div class="player-content">
            <div class="player-close">
                <i class="fas fa-times"></i>
            </div>
            <div class="player-header">
                <div class="player-title">
                    <span id="player-anime-title">Caricamento...</span>
                    <span id="current-episode">Episodio 1</span>
                </div>
                <div class="episode-selector" id="episode-selector">
                    <!-- Episodi verranno generati dinamicamente -->
                </div>
            </div>
            <div class="player-container">
                <iframe id="anime-player" src="" allowfullscreen></iframe>
            </div>
            <div class="player-controls">
                <button class="player-btn" id="prev-btn">
                    <i class="fas fa-arrow-left"></i> Precedente
                </button>
                <button class="player-btn play" id="play-btn">
                    <i class="fas fa-play"></i> Riproduci
                </button>
                <button class="player-btn" id="next-btn">
                    Successivo <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configurazione API
        const TMDB_API_KEY = 'ab9127383e0f6c02751abecfc7a89a3b';
        const TMDB_API_URL = 'https://api.themoviedb.org/3';
        const TMDB_IMG_PATH = 'https://image.tmdb.org/t/p/w500';
        const ANILIST_API = 'https://graphql.anilist.co';
        const CONSUMET_API = 'https://api.consumet.org/anime/gogoanime';
        
        // Elementi DOM
        const searchInput = document.getElementById('movie-search');
        const searchResults = document.getElementById('search-results');
        const trendingMoviesGrid = document.getElementById('trending-movies');
        const newReleasesGrid = document.getElementById('new-releases');
        const animeContentGrid = document.getElementById('anime-content');
        const genreButtons = document.querySelectorAll('.genre-btn');
        const playerModal = document.getElementById('player-modal');
        const playerClose = document.querySelector('.player-close');
        const playerTitle = document.getElementById('player-anime-title');
        const currentEpisode = document.getElementById('current-episode');
        const episodeSelector = document.getElementById('episode-selector');
        const animePlayer = document.getElementById('anime-player');
        const prevBtn = document.getElementById('prev-btn');
        const playBtn = document.getElementById('play-btn');
        const nextBtn = document.getElementById('next-btn');
        
        // Dati memorizzati
        let trendingMoviesData = [];
        let newReleasesData = [];
        let popularAnimeData = [];
        let currentAnime = null;
        let currentEpisodes = [];
        let currentEpisodeIndex = 0;
        
        // Funzione per ottenere i film in tendenza (TMDB)
        async function getTrendingMovies() {
            try {
                const response = await fetch(`${TMDB_API_URL}/trending/movie/day?api_key=${TMDB_API_KEY}&language=it-IT`);
                const data = await response.json();
                trendingMoviesData = data.results;
                displayMovies(trendingMoviesData.slice(0, 6), trendingMoviesGrid);
            } catch (error) {
                console.error('Errore nel caricamento dei film in tendenza:', error);
                trendingMoviesGrid.innerHTML = '<p class="no-results">Impossibile caricare i film in tendenza</p>';
            }
        }
        
        // Funzione per ottenere le ultime uscite (TMDB)
        async function getNewReleases() {
            try {
                const response = await fetch(`${TMDB_API_URL}/movie/now_playing?api_key=${TMDB_API_KEY}&language=it-IT&region=IT`);
                const data = await response.json();
                newReleasesData = data.results;
                displayMovies(newReleasesData.slice(0, 6), newReleasesGrid);
            } catch (error) {
                console.error('Errore nel caricamento delle ultime uscite:', error);
                newReleasesGrid.innerHTML = '<p class="no-results">Impossibile caricare le ultime uscite</p>';
            }
        }
        
        // Funzione per ottenere gli anime popolari (AniList)
        async function getPopularAnime() {
            const query = `
            query {
                Page(perPage: 6) {
                    media(type: ANIME, sort: POPULARITY_DESC) {
                        id
                        title {
                            romaji
                            english
                            native
                        }
                        coverImage {
                            large
                            color
                        }
                        averageScore
                        episodes
                        siteUrl
                    }
                }
            }`;
            
            try {
                const response = await fetch(ANILIST_API, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ query })
                });
                
                const data = await response.json();
                
                popularAnimeData = data.data.Page.media.map(anime => ({
                    id: anime.id,
                    title: anime.title.romaji || anime.title.english,
                    image: anime.coverImage.large,
                    color: anime.coverImage.color || '#4ecdc4',
                    score: (anime.averageScore / 10).toFixed(1) || 'N/A',
                    episodes: anime.episodes || '?',
                    url: anime.siteUrl
                }));
                
                displayAnime(popularAnimeData);
                
            } catch (error) {
                console.error('Errore nel caricamento degli anime:', error);
                
                // Fallback con dati di esempio
                popularAnimeData = [
                    {
                        id: 1,
                        title: "Attack on Titan",
                        image: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx16498-C6FPmWm59CyP.jpg",
                        color: "#e4a101",
                        score: "8.8",
                        episodes: 75,
                        url: "https://anilist.co/anime/16498"
                    },
                    {
                        id: 2,
                        title: "Demon Slayer",
                        image: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx101922-PEn1CTc93blC.jpg",
                        color: "#eb4d62",
                        score: "8.7",
                        episodes: 26,
                        url: "https://anilist.co/anime/101922"
                    },
                    {
                        id: 3,
                        title: "Jujutsu Kaisen",
                        image: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx113415-979nF8TZP2xC.jpg",
                        color: "#3b3bff",
                        score: "8.6",
                        episodes: 24,
                        url: "https://anilist.co/anime/113415"
                    },
                    {
                        id: 4,
                        title: "One Piece",
                        image: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx21-W7P6lkq3xYhd.jpg",
                        color: "#ff9421",
                        score: "8.5",
                        episodes: 1028,
                        url: "https://anilist.co/anime/21"
                    },
                    {
                        id: 5,
                        title: "My Hero Academia",
                        image: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx21459-XVJVUTYd8OBK.jpg",
                        color: "#3b7dff",
                        score: "8.2",
                        episodes: 113,
                        url: "https://anilist.co/anime/21459"
                    },
                    {
                        id: 6,
                        title: "Naruto Shippuden",
                        image: "https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx1735-n6No8FpzWXYW.jpg",
                        color: "#ff7a00",
                        score: "8.1",
                        episodes: 500,
                        url: "https://anilist.co/anime/1735"
                    }
                ];
                
                displayAnime(popularAnimeData);
            }
        }
        
        // Funzione per cercare anime su Consumet API
        async function searchAnime(query) {
            try {
                const response = await fetch(`${CONSUMET_API}/${encodeURIComponent(query)}`);
                return await response.json();
            } catch (error) {
                console.error('Errore nella ricerca anime:', error);
                return { results: [] };
            }
        }
        
        // Funzione per ottenere gli episodi di un anime (Consumet)
        async function getAnimeEpisodes(animeId) {
            try {
                const response = await fetch(`${CONSUMET_API}/info/${animeId}`);
                const data = await response.json();
                return data.episodes || [];
            } catch (error) {
                console.error('Errore nel caricamento degli episodi:', error);
                return [];
            }
        }
        
        // Funzione per visualizzare i film
        function displayMovies(movies, container) {
            container.innerHTML = '';
            
            if (!movies || movies.length === 0) {
                container.innerHTML = '<p class="no-results">Nessun film disponibile</p>';
                return;
            }
            
            movies.forEach(movie => {
                if (!movie.poster_path) return;
                
                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card';
                movieCard.innerHTML = `
                    <div class="type-badge">FILM</div>
                    <img src="${TMDB_IMG_PATH + movie.poster_path}" alt="${movie.title}" onerror="this.src='https://via.placeholder.com/300x450?text=Copertina+non+disponibile'">
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        <div class="movie-year">${movie.release_date ? movie.release_date.substring(0, 4) : 'N/A'}</div>
                        <div class="movie-rating">
                            <i class="fas fa-star"></i>
                            ${movie.vote_average ? movie.vote_average.toFixed(1) : 'N/A'}/10
                        </div>
                    </div>
                `;
                movieCard.addEventListener('click', () => {
                    alert(`Hai selezionato: ${movie.title}`);
                });
                container.appendChild(movieCard);
            });
        }
        
        // Funzione per visualizzare gli anime
        function displayAnime(animeList) {
            const container = document.getElementById('anime-content');
            container.innerHTML = '';
            
            if (!animeList || animeList.length === 0) {
                container.innerHTML = '<p class="no-results">Nessun anime disponibile</p>';
                return;
            }
            
            animeList.forEach(anime => {
                const animeCard = document.createElement('div');
                animeCard.className = 'movie-card';
                animeCard.dataset.id = anime.id;
                animeCard.dataset.title = anime.title;
                animeCard.innerHTML = `
                    <div class="type-badge anime-badge">ANIME</div>
                    <img src="${anime.image}" alt="${anime.title}" onerror="this.src='https://via.placeholder.com/300x450?text=Copertina+non+disponibile'">
                    <div class="movie-info" style="border-top: 3px solid ${anime.color}">
                        <div class="movie-title">${anime.title}</div>
                        <div class="movie-rating">
                            <i class="fas fa-star"></i> ${anime.score}/10
                        </div>
                    </div>
                `;
                
                animeCard.addEventListener('click', async () => {
                    const loadingEpisodes = document.createElement('div');
                    loadingEpisodes.className = 'loader';
                    container.appendChild(loadingEpisodes);
                    
                    try {
                        // Cerca l'anime su Consumet
                        const searchResults = await searchAnime(anime.title);
                        if (searchResults.results.length > 0) {
                            const consumetAnime = searchResults.results[0];
                            const episodes = await getAnimeEpisodes(consumetAnime.id);
                            
                            if (episodes.length > 0) {
                                currentAnime = {
                                    ...anime,
                                    consumetId: consumetAnime.id
                                };
                                currentEpisodes = episodes;
                                openPlayer();
                            } else {
                                alert('Nessun episodio disponibile per questo anime');
                            }
                        } else {
                            alert('Anime non trovato sul servizio di streaming');
                        }
                    } catch (error) {
                        console.error('Errore nel caricamento degli episodi:', error);
                        alert('Errore nel caricamento degli episodi');
                    } finally {
                        loadingEpisodes.remove();
                    }
                });
                
                container.appendChild(animeCard);
            });
        }
        
        // Funzione per aprire il player
        function openPlayer() {
            if (!currentAnime || currentEpisodes.length === 0) return;
            
            // Aggiorna il titolo del player
            playerTitle.textContent = currentAnime.title;
            currentEpisodeIndex = 0;
            currentEpisode.textContent = `Episodio ${currentEpisodeIndex + 1}`;
            
            // Genera i pulsanti degli episodi
            generateEpisodeButtons();
            
            // Carica il primo episodio
            loadEpisode(currentEpisodeIndex);
            
            // Mostra il player
            playerModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        // Funzione per generare i pulsanti degli episodi
        function generateEpisodeButtons() {
            episodeSelector.innerHTML = '';
            
            // Mostra solo un massimo di 10 episodi nella barra
            const maxVisibleEpisodes = 10;
            const startEpisode = Math.max(0, currentEpisodeIndex - Math.floor(maxVisibleEpisodes / 2));
            const endEpisode = Math.min(currentEpisodes.length - 1, startEpisode + maxVisibleEpisodes - 1);
            
            // Pulsante per episodi precedenti
            if (startEpisode > 0) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'episode-btn';
                prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevBtn.addEventListener('click', () => {
                    const newStart = Math.max(0, startEpisode - maxVisibleEpisodes);
                    generateEpisodeButtons(newStart);
                });
                episodeSelector.appendChild(prevBtn);
            }
            
            // Genera i pulsanti degli episodi
            for (let i = startEpisode; i <= endEpisode; i++) {
                const episodeBtn = document.createElement('button');
                episodeBtn.className = 'episode-btn';
                if (i === currentEpisodeIndex) {
                    episodeBtn.classList.add('active');
                }
                episodeBtn.textContent = i + 1;
                episodeBtn.addEventListener('click', () => {
                    currentEpisodeIndex = i;
                    loadEpisode(i);
                    // Aggiorna la classe active
                    document.querySelectorAll('.episode-btn').forEach(btn => btn.classList.remove('active'));
                    episodeBtn.classList.add('active');
                });
                episodeSelector.appendChild(episodeBtn);
            }
            
            // Pulsante per episodi successivi
            if (endEpisode < currentEpisodes.length - 1) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'episode-btn';
                nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextBtn.addEventListener('click', () => {
                    const newStart = endEpisode + 1;
                    generateEpisodeButtons(newStart);
                });
                episodeSelector.appendChild(nextBtn);
            }
        }
        
        // Funzione per caricare un episodio specifico
        function loadEpisode(index) {
            if (!currentEpisodes[index]) return;
            
            // Ottieni l'URL dello streaming dall'episodio
            const episodeId = currentEpisodes[index].id;
            const playerUrl = `${CONSUMET_API}/watch/${episodeId}`;
            
            // Aggiorna l'iframe del player
            animePlayer.src = playerUrl;
            
            // Aggiorna il numero dell'episodio corrente
            currentEpisode.textContent = `Episodio ${index + 1}`;
        }
        
        // Gestione input di ricerca
        searchInput.addEventListener('input', async function() {
            const query = this.value.trim();
            if (query.length < 3) {
                searchResults.style.display = 'none';
                return;
            }
            
            try {
                // Cerca sia film che anime
                const [moviesResponse, animeResponse] = await Promise.all([
                    fetch(`${TMDB_API_URL}/search/movie?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}&language=it-IT`),
                    searchAnime(query)
                ]);
                
                const moviesData = await moviesResponse.json();
                const movies = moviesData.results.slice(0, 5);
                const anime = animeResponse.results.slice(0, 5);
                
                // Mostra i risultati
                searchResults.innerHTML = '';
                
                if (movies.length === 0 && anime.length === 0) {
                    searchResults.innerHTML = '<div class="result-item">Nessun risultato trovato</div>';
                } else {
                    movies.forEach(movie => {
                        const item = document.createElement('div');
                        item.className = 'result-item';
                        item.innerHTML = `
                            <img src="${movie.poster_path ? TMDB_IMG_PATH + movie.poster_path : 'https://via.placeholder.com/50x70?text=No+image'}" alt="${movie.title}">
                            <div class="result-info">
                                <div class="result-title">${movie.title}</div>
                                <div class="result-year">${movie.release_date ? movie.release_date.substring(0, 4) : 'N/A'}</div>
                            </div>
                        `;
                        item.addEventListener('click', () => {
                            alert(`Hai selezionato: ${movie.title}`);
                            searchResults.style.display = 'none';
                        });
                        searchResults.appendChild(item);
                    });
                    
                    anime.forEach(anime => {
                        const item = document.createElement('div');
                        item.className = 'result-item';
                        item.innerHTML = `
                            <img src="${anime.image || 'https://via.placeholder.com/50x70?text=No+image'}" alt="${anime.title}">
                            <div class="result-info">
                                <div class="result-title">${anime.title}</div>
                                <div class="result-year">${anime.releaseDate || 'N/A'}</div>
                            </div>
                        `;
                        item.addEventListener('click', async () => {
                            const episodes = await getAnimeEpisodes(anime.id);
                            if (episodes.length > 0) {
                                currentAnime = anime;
                                currentEpisodes = episodes;
                                openPlayer();
                            } else {
                                alert('Nessun episodio disponibile per questo anime');
                            }
                            searchResults.style.display = 'none';
                        });
                        searchResults.appendChild(item);
                    });
                }
                
                searchResults.style.display = 'block';
            } catch (error) {
                console.error('Errore nella ricerca:', error);
                searchResults.innerHTML = '<div class="result-item">Errore durante la ricerca</div>';
                searchResults.style.display = 'block';
            }
        });
        
        // Chiudi i risultati di ricerca quando si clicca fuori
        document.addEventListener('click', (e) => {
            if (!searchResults.contains(e.target) && e.target !== searchInput) {
                searchResults.style.display = 'none';
            }
        });
        
        // Filtri per genere
        genreButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Rimuovi la classe active da tutti i pulsanti
                genreButtons.forEach(btn => btn.classList.remove('active'));
                
                // Aggiungi la classe active al pulsante cliccato
                this.classList.add('active');
                
                const genre = this.getAttribute('data-genre');
                
                if (genre === 'all') {
                    // Mostra tutti i contenuti
                    document.getElementById('trending-title').style.display = 'flex';
                    document.getElementById('trending-movies').style.display = 'grid';
                    document.getElementById('new-releases-title').style.display = 'flex';
                    document.getElementById('new-releases').style.display = 'grid';
                    document.getElementById('anime-title').style.display = 'flex';
                    document.getElementById('anime-content').style.display = 'grid';
                    
                    // Ripristina i contenuti originali
                    displayMovies(trendingMoviesData.slice(0, 6), trendingMoviesGrid);
                    displayMovies(newReleasesData.slice(0, 6), newReleasesGrid);
                    displayAnime(popularAnimeData);
                } 
                else if (genre === 'anime') {
                    // Mostra solo anime
                    document.getElementById('trending-title').style.display = 'none';
                    document.getElementById('trending-movies').style.display = 'none';
                    document.getElementById('new-releases-title').style.display = 'none';
                    document.getElementById('new-releases').style.display = 'none';
                    document.getElementById('anime-title').style.display = 'flex';
                    document.getElementById('anime-content').style.display = 'grid';
                } 
                else {
                    // Filtra per genere film
                    document.getElementById('trending-title').style.display = 'flex';
                    document.getElementById('trending-movies').style.display = 'grid';
                    document.getElementById('new-releases-title').style.display = 'flex';
                    document.getElementById('new-releases').style.display = 'grid';
                    document.getElementById('anime-title').style.display = 'none';
                    document.getElementById('anime-content').style.display = 'none';
                    
                    const filteredTrending = trendingMoviesData.filter(movie => 
                        movie.genre_ids.includes(parseInt(genre))
                    ).slice(0, 6);
                    
                    const filteredNewReleases = newReleasesData.filter(movie => 
                        movie.genre_ids.includes(parseInt(genre))
                    ).slice(0, 6);
                    
                    displayMovies(filteredTrending, trendingMoviesGrid);
                    displayMovies(filteredNewReleases, newReleasesGrid);
                }
            });
        });
        
        // Chiudi il player
        playerClose.addEventListener('click', function() {
            playerModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            animePlayer.src = ''; // Ferma la riproduzione
        });
        
        // Navigazione episodi
        prevBtn.addEventListener('click', function() {
            if (currentEpisodeIndex > 0) {
                currentEpisodeIndex--;
                loadEpisode(currentEpisodeIndex);
                generateEpisodeButtons();
            }
        });
        
        nextBtn.addEventListener('click', function() {
            if (currentEpisodeIndex < currentEpisodes.length - 1) {
                currentEpisodeIndex++;
                loadEpisode(currentEpisodeIndex);
                generateEpisodeButtons();
            }
        });
        
        // Riproduci l'episodio corrente
        playBtn.addEventListener('click', function() {
            loadEpisode(currentEpisodeIndex);
        });
        
        // Inizializzazione
        window.addEventListener('DOMContentLoaded', () => {
            getTrendingMovies();
            getNewReleases();
            getPopularAnime();
        });
    </script>
</body>
</html>